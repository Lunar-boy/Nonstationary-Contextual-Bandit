# Nonstationary Contextual Bandit (Teacher–Learner Simulation)

A compact simulation suite for nonstationary contextual bandits with a **discounted LinUCB** learner and a **teacher mixture** intervention. The code sweeps nonstationarity 
parameters and teacher budgets, then reports dynamic regret, policy mismatch against a canonical target, and policy stability. Plotting utilities generate paper-ready figures 
plus a global tradeoff table.

## What’s inside
- **Nonstationary environment**: piecewise-stationary segments with drift magnitude `eta` and segment count `M`.
- **Learner**: Discounted LinUCB with exponential forgetting.
- **Teacher (mixture)**: blends true rewards with canonical rewards under budget `C/T`.
- **Metrics**: dynamic regret, average regret, mismatch to target policy, stability.
- **Plotting + tables**: automated figures and LaTeX tables for summaries.

## Repo layout
- `nonstationary_bandit.py` — experiment runner, environment, learner, and teacher.
- `analysis/make_plots.py` — plotting + summary table generation.
- `nonstationary_bandit_results_merged.csv` — example merged results (from prior runs).

## Quickstart
Install dependencies (full environment):

```bash
pip install -r requirements.txt
```

Run the full sweep and generate plots:

```bash
python nonstationary_bandit.py
```

Run a single seed (useful for Slurm job arrays):

```bash
SEED_OVERRIDE=0 python nonstationary_bandit.py
```

## Outputs
The main script writes CSVs and then calls the plotting module.

- **Per-seed CSVs** (if `SEED_OVERRIDE` is set):
  - `nonstationary_bandit_results_seed{seed}.csv`
- **Merged CSV** (auto-concatenated if per-seed files exist):
  - `nonstationary_bandit_results_merged.csv`
- **Single CSV** (when not running per-seed):
  - `nonstationary_bandit_results.csv`
- **Figures and tables** (generated by `analysis/make_plots.py`):
  - Budget sweeps: `figure_teaching_error_vs_budget.*`, `figure_avgreg_vs_budget.*`, `figure_stability_vs_budget.*`
  - Frontier plots: `appendix_regret_vs_mismatch.*`
  - Paired deltas and trajectories: `figures_ns_bandit/appendix_*.*`
  - Global tradeoff summary: `tradeoff_summary_global.csv`, `tradeoff_summary_global.tex`

## Configuration
All hyperparameters live in `Config` inside `nonstationary_bandit.py`. Key knobs:

- `T`, `d_ctx`, `A` — horizon, context dimension, number of arms
- `M_grid`, `eta_grid` — nonstationarity sweep
- `C_grid_frac` — teacher budgets as fractions of `T`
- `gamma`, `lambda_reg`, `alpha_ucb` — discounted LinUCB hyperparameters

## Notes

- The plotting module expects the CSV columns produced by `nonstationary_bandit.py`.

## License
Specify your license here (e.g., MIT, Apache-2.0).
